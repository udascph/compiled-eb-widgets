System.register(["jimu-core","jimu-core/react","jimu-ui","esri/geometry/projection","esri/geometry/SpatialReference","jimu-arcgis","esri/Graphic","esri/geometry/Point"],(function(e,t){var n={},a={},r={},o={},l={},i={},c={},s={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.DataSourceStatus=e.DataSourceStatus,n.React=e.React},function(e){a.createContext=e.createContext,a.memo=e.memo,a.useCallback=e.useCallback,a.useContext=e.useContext,a.useEffect=e.useEffect,a.useRef=e.useRef,a.useState=e.useState},function(e){r.Alert=e.Alert,r.Button=e.Button,r.Label=e.Label,r.Link=e.Link,r.ListGroup=e.ListGroup,r.ListGroupItem=e.ListGroupItem,r.Loading=e.Loading,r.Modal=e.Modal,r.ModalBody=e.ModalBody,r.ModalFooter=e.ModalFooter,r.ModalHeader=e.ModalHeader,r.Option=e.Option,r.Select=e.Select,r.TextInput=e.TextInput},function(e){o.default=e.default},function(e){l.default=e.default},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent},function(e){c.default=e.default},function(e){s.default=e.default}],execute:function(){e((()=>{var e={8086:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(8081),r=n.n(a),o=n(3645),l=n.n(o)()(r());l.push([e.id,".widget-runtime-error{background-color:#d5d8dc;border:1px solid gray}",""]);const i=l},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var l={};if(a)for(var i=0;i<this.length;i++){var c=this[i][0];null!=c&&(l[c]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);a&&l[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},l=[],i=0;i<e.length;i++){var c=e[i],s=a.base?c[0]+a.base:c[0],u=o[s]||0,d="".concat(s," ").concat(u);o[s]=u+1;var m=n(d),v={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==m)t[m].references++,t[m].updater(v);else{var p=r(v,a);a.byIndex=i,t.splice(i,0,{identifier:d,updater:p,references:1})}l.push(d)}return l}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=a(e=e||[],r=r||{});return function(e){e=e||[];for(var l=0;l<o.length;l++){var i=n(o[l]);t[i].references--}for(var c=a(e,r),s=0;s<o.length;s++){var u=n(o[s]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=c}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4129:e=>{"use strict";e.exports=c},8294:e=>{"use strict";e.exports=s},5443:e=>{"use strict";e.exports=l},8900:e=>{"use strict";e.exports=o},6826:e=>{"use strict";e.exports=i},8891:e=>{"use strict";e.exports=n},1315:e=>{"use strict";e.exports=a},726:e=>{"use strict";e.exports=r}},t={};function u(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,u),r.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="",u.nc=void 0;var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{WidgetContext:()=>re,__set_webpack_public_path__:()=>le,default:()=>oe});var e=u(8891),t=u(3379),n=u.n(t),a=u(7795),r=u.n(a),o=u(569),l=u.n(o),i=u(3565),c=u.n(i),s=u(9216),m=u.n(s),v=u(4589),p=u.n(v),g=u(8086),E={};E.styleTagTransform=p(),E.setAttributes=c(),E.insert=l().bind(null,"head"),E.domAPI=r(),E.insertStyleElement=m(),n()(g.Z,E),g.Z&&g.Z.locals&&g.Z.locals;var R=u(1315);const f=e=>{if(e)return new Date(e).toISOString().split("T")[0]},y=e=>{if(e)return new Date(e).getTime()},S={where:"1=2",outFields:["*"],pageSize:5,page:1};var b,h,_;function C(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function D(e,t){const n=null==t?void 0:t.find((t=>t.code===e));return n?n.value:e}!function(e){e.Inactive="Inactive",e.Active="Active",e.Error="Error"}(b||(b={})),function(e){e.SplashScreen="SplashScreen",e.Search="Search",e.DisplayDossier="DisplayDossier",e.CreateDossier="CreateDossier",e.EditDossier="EditDossier",e.DisplayIntervention="DisplayIntervention",e.CreateIntervention="CreateIntervention",e.EditIntervention="EditIntervention",e.DisplayLot="DisplayLot",e.CreateLot="CreateLot",e.EditLot="EditLot"}(h||(h={})),function(e){e.Edit="privilegesEdit",e.Add="privilegesAdd",e.Delete="privilegesDelete"}(_||(_={}));var I=u(726);const L=function({title:t="Title",navbar:n=null,body:a=null,buttons:r=null,lowerButtons:o=null}){return e.React.createElement("div",{className:"m-2"},e.React.createElement("h3",null,t),e.React.createElement("hr",null),n,a,(r||o)&&e.React.createElement("hr",null),r&&e.React.createElement("div",{className:"my-3"},r),o)},w=function({widgetTitle:t}){const n=e.React.createElement(I.Alert,{className:"m-2",buttonType:"default",form:"basic",open:!0,size:"medium",text:"Veuillez compléter la configuration du widget.",type:"warning",withIcon:!0});return e.React.createElement(L,{title:t,body:n})},x=function({searchKey:t,searchField:n,keyFromUserInput:a=!1}){const{widgetId:r,searchResultsLimit:o,dsDossier:l,setActiveSection:i,setDossier:c,setDossiersCount:s,limitDossiersSearchResults:u}=(0,R.useContext)(re),d=e.React.createElement("div",{style:{position:"relative",top:"5px"}},e.React.createElement(I.Loading,{type:"BAR"})),m=(()=>{let e="1=1";const a=t&&(t.length>0||t>0);return a&&"id_dossier"===n&&(e=`${n} = ${t}`),a&&"no_dossier"===n&&(e=`${n} LIKE '%${t}%'`),"objectid"===n&&t&&"number"==typeof t&&(e=`${n} = ${t}`),{where:e,outFields:["*"],pageSize:5,page:1,orderByFields:["no_dossier"]}})();return e.React.createElement(e.DataSourceComponent,{useDataSource:l[0],query:m,widgetId:r,queryCount:!0},((n,r)=>{let l=!1;return a?(null==t?void 0:t.length)>2&&(l=!0):"number"==typeof t&&t>0&&(l=!0),s(l?n.count:null),n.getStatus()===e.DataSourceStatus.Loading&&l?d:n.getStatus()===e.DataSourceStatus.LoadError&&l?e.React.createElement("div",null,"Erreur..."):n.getStatus()===e.DataSourceStatus.Loaded&&n.count>0&&l&&e.React.createElement(I.Label,null,e.React.createElement(I.ListGroup,null,(t=>{let n=[...t];return u&&(n=t.slice(0,o)),n.map((t=>{const n=t.getData();return e.React.createElement(I.ListGroupItem,{className:"py-1 px-2",action:!0,tag:"button",onClick:()=>{return e=n.objectid,c(e),void i(h.DisplayDossier);var e},key:n.objectid}," Dossier ",n.no_dossier)}))})(n.getRecords())))}))},F=function({label:t="Afficher plus",onClick:n}){return e.React.createElement(I.Link,{className:"p-0",size:"sm",type:"tertiary",onClick:n}," ",t)},A=({queryString:t="1=1",dataSource:n})=>{const{widgetId:a}=(0,R.useContext)(re),r={where:t,outFields:["*"],pageSize:10};return n&&e.React.createElement(e.DataSourceComponent,{useDataSource:n,query:r,widgetId:a,queryCount:!0})};var k=u(8900),j=u(5443),T=u(6826);const N=({queryString:t="1=2",dataSourceSel:n,zoomToSelection:a=!0})=>{const{widgetId:r,useMapWidgetIds:o}=(0,R.useContext)(re),[l,i]=(0,R.useState)(),c={where:t,outFields:["*"],pageSize:10,returnGeometry:!0},s=(0,R.useCallback)((e=>{e&&i(e)}),[]),u=e=>{return t=void 0,n=void 0,r=function*(){if(!l)return void console.error("JimuMapView not ready");let t=new j.default({wkid:4326});yield k.default.load();const n=k.default.project(e,t);yield k.default.load(),l.view.goTo({center:[n.longitude,n.latitude],zoom:17})},new((a=void 0)||(a=Promise))((function(e,o){function l(e){try{c(r.next(e))}catch(e){o(e)}}function i(e){try{c(r.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(l,i)}c((r=r.apply(t,n||[])).next())}));var t,n,a,r};return e.React.createElement(e.React.Fragment,null,e.React.createElement(T.JimuMapViewComponent,{useMapWidgetId:null==o?void 0:o[0],onActiveViewChange:s}),l&&e.React.createElement(e.DataSourceComponent,{useDataSource:n,query:{},widgetId:r,queryCount:!0,onDataSourceCreated:e=>{e.query(c).then((t=>{if(((e,t)=>{t?e.selectRecords({records:t}):console.log("No records to select.")})(e,t.records),t.records.length&&a){const e=(e=>{const t=e.reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e)),{x:0,y:0}),n={x:t.x/e.length,y:t.y/e.length,spatialReference:e[0].spatialReference};return n.y-=70,n})(t.records.map((e=>e.getGeometry())));u(e)}}))}}))},B=function(){const[t,n]=(0,R.useState)(),{dsLot:a,dsIntervention:r,dsLotIntVue:o,searchResultsLimit:l,setActiveSection:i,setDossier:c,privilegesAdd:s,dossiersCount:u,limitDossiersSearchResults:d,setLimitDossiersSearchResults:m}=(0,R.useContext)(re),v=e.React.createElement(I.TextInput,{onChange:e=>{const t=e.target.value;m(!0),n(t)},placeholder:"Recherche de dossier EG",type:"search",value:t}),p=e.React.createElement("div",null,e.React.createElement(x,{searchKey:t,searchField:"no_dossier",keyFromUserInput:!0})),g=null!=u&&u>l&&d&&e.React.createElement(F,{label:`+ ${u-l} résultats`,onClick:()=>m(!1)}),E=s&&e.React.createElement(I.Button,{onClick:()=>{c(null),i(h.CreateDossier)},size:"default",type:"default"},"Créer dossier"),f=e.React.createElement("div",{className:"container"},e.React.createElement("div",{className:"row pt-2"},e.React.createElement("div",{className:"col-sm-7 px-0"},v,p,g),e.React.createElement("div",{className:"col-sm-5 ml-2 p-0"},E)));return e.React.createElement(e.React.Fragment,null,e.React.createElement(L,{title:"Gestion des dossier EG",body:f}),e.React.createElement(A,{dataSource:r[0]}),e.React.createElement(A,{dataSource:a[0]}),e.React.createElement(N,{dataSourceSel:o[0]}))},O=(0,R.memo)((function({searchKey:t,searchField:n,label:a="Interventions"}){const{widgetId:r,dsIntervention:o,setIntervention:l,setActiveSection:i,valueLists:c,setInterventionsCount:s}=(0,R.useContext)(re),u=(()=>{let e="1=1";const a=t&&(t.length>0||t>0);return a&&"id_dg_demande"===n&&(e=`${n} = ${t}`),a&&"id_dossier"===n&&(e=`${n} = ${t}`),{where:e,outFields:["*"],pageSize:5,page:1,orderByFields:["id_dg_demande"]}})();return e.React.createElement(e.DataSourceComponent,{useDataSource:o[0],query:u,widgetId:r,queryCount:!0},((n,r)=>(n.getStatus()===e.DataSourceStatus.Loaded&&s(n.count),n.getStatus()===e.DataSourceStatus.LoadError?e.React.createElement(I.Label,null,a," ","Erreur..."," "):n.getStatus()===e.DataSourceStatus.Loading?e.React.createElement(I.Label,null,a," ","Chargement..."):n.getStatus()===e.DataSourceStatus.Loaded&&n.count>0&&t&&(t.length>0||t>0)?e.React.createElement(I.Label,null,a,e.React.createElement(I.ListGroup,null,n.getRecords().map((t=>{const n=t.getData();return e.React.createElement(I.ListGroupItem,{className:"py-1 px-2",action:!0,tag:"button",onClick:()=>{return e=n.objectid,l(e),void i(h.DisplayIntervention);var e},key:n.objectid}," ",D(n.code_demande,null==c?void 0:c.interventionType))})))):void 0)))})),M=({onDelete:t,elementName:n,disabled:a,btnLabel:r="Supprimer",deleteStatus:o})=>{const[l,i]=(0,R.useState)(!1),c=()=>i(!l);return e.React.createElement(e.React.Fragment,null,e.React.createElement(I.Button,{className:"mx-1",type:"danger",size:"default",disabled:a,onClick:c},r),e.React.createElement(I.Modal,{isOpen:l,toggle:c},e.React.createElement(I.ModalHeader,{toggle:c},"Confirmer suppression"),e.React.createElement(I.ModalBody,null,"Voulez-vous supprimer ",n," ?"),e.React.createElement(I.ModalFooter,null,e.React.createElement(I.Button,{type:"danger",onClick:()=>{t(),c()}},"Oui, supprimer")," ",e.React.createElement(I.Button,{type:"default",onClick:c},"Non"))))},$=function(){return e.React.createElement("div",{style:{height:"80px",position:"relative",width:"200px"}},e.React.createElement(I.Loading,{type:"DONUT"}))},q=function(){const{widgetId:t,widgetTitle:n,setActiveSection:a,valueLists:r,privilegesEdit:o,privilegesAdd:l,privilegesDelete:i,dossier:c,dsDossier:s,setDossierAttributes:u,interventionsCount:d,dsLot:m,dsLotIntVue:v}=(0,R.useContext)(re),[p,g]=(0,R.useState)(null),[E,y]=(0,R.useState)(b.Inactive),S={where:`objectid = ${c}`,outFields:["*"],pageSize:10},_=()=>{y(b.Active);const e=p.layer;if(!e.editingEnabled)return y(b.Error),void console.log("layer.editingEnabled",e.editingEnabled);e.applyEdits({deleteFeatures:[{objectId:c}]}).then((function(e){y(b.Inactive),a(h.Search)})).catch((function(e){y(b.Error),console.log("delete failed: ",e)}))},C=e.React.createElement(I.Button,{className:"mx-1",onClick:()=>a(h.Search),size:"default",type:"default"},"Retour"),w=(0,R.useCallback)((e=>{g(e)}),[]);return e.React.createElement(e.React.Fragment,null,e.React.createElement(e.DataSourceComponent,{widgetId:t,useDataSource:s[0],query:S,queryCount:!0,onDataSourceCreated:w},((t,c)=>{let s;if(t.getStatus()===e.DataSourceStatus.LoadError){const t=e.React.createElement(I.Alert,{open:!0,text:"Erreur de connexion",type:"error",withIcon:!0});s=e.React.createElement(L,{title:n,body:t,lowerButtons:C})}else if(t.getStatus()===e.DataSourceStatus.Loaded&&0===t.count){const t=e.React.createElement(I.Alert,{open:!0,text:"Introuvable",type:"warning",withIcon:!0});s=e.React.createElement(L,{title:n,body:t,lowerButtons:C})}else if(t.getStatus()===e.DataSourceStatus.Loading){const t=e.React.createElement($,null);s=e.React.createElement(L,{title:n,body:t,lowerButtons:C})}else if(t.getStatus()===e.DataSourceStatus.Loaded&&t.count>0){const c=t.getRecords()[0].getData();u(c);const m=`${n} ${c.no_dossier}`,p=e.React.createElement(O,{searchKey:c.id_dossier,searchField:"id_dossier",label:"Interventions"}),g=e.React.createElement(e.React.Fragment,null,e.React.createElement("div",null,e.React.createElement(I.Label,null,"Type d'élément : ",D(c.code_type,null==r?void 0:r.dossierType))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Date ouverture : ",f(c.date_ouverture))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Note générale : ",c.note_generale)),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Création : ",f(c.date_creation)," par ",c.usager_creation," ")),c.date_modification&&e.React.createElement("div",null,e.React.createElement(I.Label,null,"Dernière modification : ",f(c.date_modification)," par ",c.usager_modification)),e.React.createElement("div",null,p));let R="Supprimer";E==b.Error?R="Erreur":E==b.Inactive?R="Supprimer":E==b.Active&&(R="Suppression...");const y=e.React.createElement(e.React.Fragment,null,l&&e.React.createElement(I.Button,{className:"mx-1",onClick:()=>a(h.CreateIntervention),size:"default",type:"primary"},"Créer intervention"),o&&e.React.createElement(I.Button,{className:"mx-1",onClick:()=>a(h.EditDossier),size:"default",type:"primary"},"Modifier"),i&&e.React.createElement(M,{onDelete:_,btnLabel:R,disabled:d>0||E==b.Active,elementName:`le dossier ${c.no_dossier}`,deleteStatus:E}));s=e.React.createElement(e.React.Fragment,null,e.React.createElement(L,{title:m,body:g,buttons:y,lowerButtons:C}),e.React.createElement(N,{dataSourceSel:v[0],queryString:`no_dossier = '${c.no_dossier}'`}))}return s})),e.React.createElement(A,{dataSource:m[0]}))};var z=u(4129);const V=function({label:t="Sauvegarder"}){return e.React.createElement("div",{style:{position:"relative"}},t,e.React.createElement(I.Loading,{height:null,width:null,type:"BAR"}))},G=function({handleInputChange:t,handleSaveClick:n,handleDropdownChange:a,inputs:r,valueLists:o,handleBackClick:l,title:i,saveStatus:c}){const s=e.React.createElement(e.React.Fragment,null,e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," *Type d'élément",e.React.createElement(I.Select,{"aria-label":"",placeholder:"Choisir...",value:r.code_type,onChange:e=>a(e,"code_type")},o.dossierType.map((t=>e.React.createElement(I.Option,{key:t.code,value:t.code},t.value)))))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Date d'ouverture",e.React.createElement(I.TextInput,{onChange:t,type:"date",name:"date_ouverture",value:null==r?void 0:r.date_ouverture}))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Note générale",e.React.createElement(I.TextInput,{type:"text",name:"note_generale",onChange:t,value:r.note_generale||""})))),u=null!=r.code_type;let d="Sauvegarder",m=!1,v=!1;c===b.Inactive?(d="Sauvegarder",m=!u):c===b.Active?(d=e.React.createElement(V,{label:"Sauvegarde..."}),m=!0,v=!0):c===b.Error&&(d="Erreur...",m=!0);const p=e.React.createElement(e.React.Fragment,null,e.React.createElement(I.Button,{onClick:l,size:"default",type:"default",disabled:v},"Retour"),e.React.createElement(I.Button,{className:"mx-2",onClick:n,size:"default",type:"primary",disabled:m},d));return e.React.createElement(L,{title:i,body:s,buttons:p})},P=function(){const{widgetId:t,dsDossier:n,setDossier:a,setActiveSection:r,valueLists:o}=(0,R.useContext)(re),[l,i]=(0,R.useState)(null),[c,s]=(0,R.useState)(b.Inactive),[u,d]=(0,R.useState)({code_type:null,date_ouverture:C(),note_generale:""});return e.React.createElement(e.React.Fragment,null,e.React.createElement(G,{title:"Créer dossier",handleInputChange:e=>{const t=e.target.name,n=e.target.value;d((e=>Object.assign(Object.assign({},e),{[t]:n})))},handleSaveClick:()=>{s(b.Active);const e=[new z.default({attributes:{code_type:u.code_type,date_ouverture:y(u.date_ouverture),note_generale:u.note_generale}})],t=l.layer;if(!t.editingEnabled)return s(b.Error),void console.log("layer.editingEnabled",t.editingEnabled);t.applyEdits({addFeatures:e}).then((function(e){s(b.Inactive);const t=e.addFeatureResults[0].objectId;a(t),r(h.DisplayDossier)})).catch((function(e){s(b.Error),console.log("create failed: ",e)}))},handleDropdownChange:(e,t)=>{const n=e.target.value;d((e=>Object.assign(Object.assign({},e),{[t]:n})))},inputs:u,valueLists:o,handleBackClick:()=>r(h.Search),saveStatus:c}),n&&e.React.createElement(e.DataSourceComponent,{useDataSource:n[0],query:{},widgetId:t,queryCount:!0,onDataSourceCreated:e=>{i(e)}}))},K=function(){const{widgetId:t,dsDossier:n,setActiveSection:a,dossierAttributes:r,valueLists:o}=(0,R.useContext)(re),[l,i]=(0,R.useState)(null),[c,s]=(0,R.useState)(b.Inactive),[u,d]=(0,R.useState)({code_type:r.code_type,note_generale:r.note_generale,date_ouverture:f(r.date_ouverture)});return e.React.createElement(e.React.Fragment,null,e.React.createElement(G,{title:`Dossier ${r.no_dossier}`,handleInputChange:e=>{const t=e.target.name,n=e.target.value;d((e=>Object.assign(Object.assign({},e),{[t]:n})))},handleSaveClick:()=>{s(b.Active);const e=[new z.default({attributes:{objectid:r.objectid,code_type:u.code_type,date_ouverture:y(u.date_ouverture),note_generale:u.note_generale}})],t=l.layer;if(!t.editingEnabled)return s(b.Error),void console.log("layer.editingEnabled",t.editingEnabled);t.applyEdits({updateFeatures:e}).then((function(e){s(b.Inactive),a(h.DisplayDossier)})).catch((function(e){s(b.Error),console.log("edit failed: ",e)}))},handleDropdownChange:(e,t)=>{const n=e.target.value;d((e=>Object.assign(Object.assign({},e),{[t]:n})))},inputs:u,valueLists:o,handleBackClick:()=>a(h.DisplayDossier),saveStatus:c}),n&&e.React.createElement(e.DataSourceComponent,{useDataSource:n[0],query:{},widgetId:t,queryCount:!0,onDataSourceCreated:e=>{i(e)}}))},J=function({searchKey:t,searchField:n,label:a="Lots"}){const{widgetId:r,dsLot:o,setActiveSection:l,setLot:i,setLotsCount:c}=(0,R.useContext)(re),s=(()=>{let e="1=1";return t&&(t.length>0||t>0)&&"id_dg_demande"===n&&(e=`${n} = ${t}`),{where:e,outFields:["*"],pageSize:10}})();if(s)return e.React.createElement(e.React.Fragment,null,e.React.createElement(e.DataSourceComponent,{useDataSource:o[0],query:s,widgetId:r,queryCount:!0},((n,r)=>(n.getStatus()===e.DataSourceStatus.Loaded&&c(n.count),n.getStatus()===e.DataSourceStatus.LoadError?e.React.createElement(I.Label,null,a," ","Erreur..."," "):n.getStatus()===e.DataSourceStatus.Loading?e.React.createElement(I.Label,null,a," ","Chargement..."):n.getStatus()===e.DataSourceStatus.Loaded&&n.count>0&&t&&(t.length>0||t>0)?e.React.createElement(I.Label,null,a,e.React.createElement(I.ListGroup,null,n.getRecords().map((t=>{const n=t.getData(),a=n.no_lot&&n.no_lot.length>0?n.no_lot:`oid-${n.objectid}`;return e.React.createElement(I.ListGroupItem,{className:"py-1 px-2",action:!0,tag:"button",onClick:()=>{return e=n.objectid,i(e),void l(h.DisplayLot);var e},key:n.objectid}," Lot ",a)})))):void 0))))},W=function(){const{widgetId:t,privilegesAdd:n,privilegesEdit:a,privilegesDelete:r,setActiveSection:o,valueLists:l,dsIntervention:i,intervention:c,setInterventionAttributes:s,lotsCount:u,dsLotIntVue:d}=(0,R.useContext)(re),[m,v]=(0,R.useState)(null),[p,g]=(0,R.useState)(b.Inactive),E={where:`objectid = ${c}`,outFields:["*"],pageSize:10},y=()=>{g(b.Active);const e=m.layer;if(!e.editingEnabled)return g(b.Error),void console.log("layer.editingEnabled",e.editingEnabled);e.applyEdits({deleteFeatures:[{objectId:c}]}).then((function(e){g(b.Inactive),o(h.DisplayDossier)})).catch((function(e){g(b.Error),console.log("delete failed: ",e)}))},S=e.React.createElement(I.Button,{className:"mx-1",onClick:()=>o(h.DisplayDossier),size:"default",type:"default"},"Retour"),_=(0,R.useCallback)((e=>{v(e)}),[]);return e.React.createElement(e.React.Fragment,null,e.React.createElement(e.DataSourceComponent,{useDataSource:i[0],query:E,widgetId:t,queryCount:!0,onDataSourceCreated:_},((t,i)=>{let c;if(t.getStatus()===e.DataSourceStatus.LoadError){const t=e.React.createElement(I.Alert,{open:!0,text:"Erreur de connexion",type:"error",withIcon:!0});c=e.React.createElement(L,{title:"Intervention",body:t,lowerButtons:S})}else if(t.getStatus()===e.DataSourceStatus.Loaded&&0===t.count){const t=e.React.createElement(I.Alert,{open:!0,text:"Introuvable",type:"warning",withIcon:!0});c=e.React.createElement(L,{title:"Intervention",body:t,lowerButtons:S})}else if(t.getStatus()===e.DataSourceStatus.Loading){const t=e.React.createElement($,null);c=e.React.createElement(L,{title:"Intervention",body:t,lowerButtons:S})}else if(t.getStatus()===e.DataSourceStatus.Loaded&&t.count>0){const i=t.getRecords()[0].getData();s(i);const m=`Intervention ${i.id_dg_demande}`,v=e.React.createElement("div",null,e.React.createElement(x,{searchKey:i.id_dossier,searchField:"id_dossier"})),g=e.React.createElement(J,{searchKey:i.id_dg_demande,searchField:"id_dg_demande",label:"Lots"}),E=e.React.createElement(e.React.Fragment,null,e.React.createElement("div",null,e.React.createElement(I.Label,null,"Type : ",D(i.code_demande,null==l?void 0:l.interventionType))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"État : ",D(i.code_etat,null==l?void 0:l.interventionEtat))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Demandeur : ",i.nom_demandeur)),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Début : ",f(i.date_deb))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Fin : ",f(i.date_fin))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Note générale : ",i.note_generale)),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Responsable : ",D(i.arpenteur_geometre,null==l?void 0:l.intervenants))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Livraison prévue : ",f(i.date_livraison))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Création : ",f(i.date_creation)," par ",i.usager_creation," ")),i.date_modification&&e.React.createElement("div",null,e.React.createElement(I.Label,null,"Dernière modification : ",f(i.date_modification)," par ",i.usager_modification)),e.React.createElement("div",null,g));let R="Supprimer";p==b.Error?R="Erreur":p==b.Inactive?R="Supprimer":p==b.Active&&(R="Suppression...");const _=e.React.createElement(e.React.Fragment,null,n&&e.React.createElement(I.Button,{className:"mx-1",onClick:()=>o(h.CreateLot),size:"default",type:"primary"},"Ajouter lot"),a&&e.React.createElement(I.Button,{className:"mx-1",onClick:()=>o(h.EditIntervention),size:"default",type:"primary"},"Modifier"),r&&e.React.createElement(M,{onDelete:y,btnLabel:R,disabled:u>0||p==b.Active,elementName:`l'ntervention ${i.id_dg_demande} ${D(i.code_demande,null==l?void 0:l.interventionType)}`,deleteStatus:p}));c=e.React.createElement(e.React.Fragment,null,e.React.createElement(L,{title:m,navbar:v,body:E,buttons:_,lowerButtons:S}),e.React.createElement(N,{dataSourceSel:d[0],queryString:`id_dg_demande = ${i.id_dg_demande}`}))}return c})))},U=function({handleInputChange:t,handleSaveClick:n,handleDropdownChange:a,inputs:r,valueLists:o,handleBackClick:l,title:i,saveStatus:c}){const s=e.React.createElement(e.React.Fragment,null,e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," *Type",e.React.createElement(I.Select,{"aria-label":"",buttonProps:{},placeholder:"Choisir...",value:r.code_demande,onChange:e=>a(e,"code_demande")},o.interventionType.map((t=>e.React.createElement(I.Option,{key:t.code,value:t.code},t.value)))))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," *État",e.React.createElement(I.Select,{"aria-label":"",buttonProps:{},placeholder:"Choisir...",value:r.code_etat,onChange:e=>a(e,"code_etat")},o.interventionEtat.map((t=>e.React.createElement(I.Option,{key:t.code,value:t.code},t.value)))))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Nom demandeur",e.React.createElement(I.TextInput,{type:"text",name:"nom_demandeur",onChange:t,value:r.nom_demandeur||""}))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Date début",e.React.createElement(I.TextInput,{type:"date",name:"date_deb",value:r.date_deb,onChange:t}))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Date fin",e.React.createElement(I.TextInput,{type:"date",name:"date_fin",value:r.date_fin,onChange:t}))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Note générale",e.React.createElement(I.TextInput,{type:"text",name:"note_generale",onChange:t,value:r.note_generale||""}))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," *Responsable",e.React.createElement(I.Select,{"aria-label":"",buttonProps:{},placeholder:"Choisir...",value:r.arpenteur_geometre,onChange:e=>a(e,"arpenteur_geometre")},o.intervenants.map((t=>e.React.createElement(I.Option,{key:t.code,value:t.code},t.value)))))),e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Date livraison",e.React.createElement(I.TextInput,{type:"date",name:"date_livraison",value:r.date_livraison,onChange:t})))),u=null!=r.code_demande&&null!=r.code_etat&&null!=r.arpenteur_geometre&&""!=r.arpenteur_geometre;let d="Sauvegarder",m=!1,v=!1;c===b.Inactive?(d="Sauvegarder",m=!u):c===b.Active?(d=e.React.createElement(V,{label:"Sauvegarde..."}),m=!0,v=!0):c===b.Error&&(d="Erreur...",m=!0);const p=e.React.createElement(e.React.Fragment,null,e.React.createElement(I.Button,{onClick:l,size:"default",type:"default",disabled:v},"Retour"),e.React.createElement(I.Button,{className:"mx-2",onClick:n,size:"default",type:"primary",disabled:m},d));return e.React.createElement(L,{title:i,body:s,buttons:p})},H=function(){const{widgetId:t,dsIntervention:n,setIntervention:a,setActiveSection:r,dossierAttributes:o,valueLists:l}=(0,R.useContext)(re),[i,c]=(0,R.useState)(null),[s,u]=(0,R.useState)(b.Inactive),[d,m]=(0,R.useState)({code_demande:null,code_etat:null,nom_demandeur:null,date_deb:C(),date_fin:null,note_generale:"",arpenteur_geometre:null,date_livraison:null});return e.React.createElement(e.React.Fragment,null,e.React.createElement(U,{title:"Créer intervention",handleInputChange:e=>{const t=e.target.name,n=e.target.value;m((e=>Object.assign(Object.assign({},e),{[t]:n})))},handleSaveClick:()=>{u(b.Active);const e=[new z.default({attributes:{no_dossier:o.no_dossier,id_dossier:o.id_dossier,code_demande:d.code_demande,code_etat:d.code_etat,nom_demandeur:d.nom_demandeur,date_deb:y(d.date_deb),date_fin:y(d.date_fin),note_generale:d.note_generale,arpenteur_geometre:d.arpenteur_geometre,date_livraison:y(d.date_livraison)}})],t=i.layer;if(!t.editingEnabled)return u(b.Error),void console.log("layer.editingEnabled",t.editingEnabled);t.applyEdits({addFeatures:e}).then((function(e){u(b.Inactive);const t=e.addFeatureResults[0].objectId;a(t),r(h.DisplayIntervention)})).catch((function(e){u(b.Error),console.log("add failed: ",e)}))},handleDropdownChange:(e,t)=>{const n=e.target.value;m((e=>Object.assign(Object.assign({},e),{[t]:n})))},inputs:d,valueLists:l,handleBackClick:()=>r(h.DisplayDossier),saveStatus:s}),n&&e.React.createElement(e.DataSourceComponent,{useDataSource:n[0],query:{},widgetId:t,queryCount:!0,onDataSourceCreated:e=>{c(e)}}))},Z=function(){const{widgetId:t,dsIntervention:n,setActiveSection:a,interventionAttributes:r,valueLists:o}=(0,R.useContext)(re),[l,i]=(0,R.useState)(null),[c,s]=(0,R.useState)(b.Inactive),[u,d]=(0,R.useState)({code_demande:r.code_demande,code_etat:r.code_etat,nom_demandeur:r.nom_demandeur,date_deb:f(r.date_deb),date_fin:f(r.date_fin),note_generale:r.note_generale,arpenteur_geometre:r.arpenteur_geometre,date_livraison:f(r.date_livraison)});return e.React.createElement(e.React.Fragment,null,e.React.createElement(U,{title:`Intervention ${r.id_dg_demande}`,handleInputChange:e=>{const t=e.target.name,n=e.target.value;d((e=>Object.assign(Object.assign({},e),{[t]:n})))},handleSaveClick:()=>{s(b.Active);const e=[new z.default({attributes:{objectid:r.objectid,code_demande:u.code_demande,code_etat:u.code_etat,nom_demandeur:u.nom_demandeur,date_deb:y(u.date_deb),date_fin:y(u.date_fin),note_generale:u.note_generale,arpenteur_geometre:u.arpenteur_geometre,date_livraison:y(u.date_livraison)}})],t=l.layer;if(!t.editingEnabled)return s(b.Error),void console.log("layer.editingEnabled",t.editingEnabled);t.applyEdits({updateFeatures:e}).then((function(e){s(b.Inactive),a(h.DisplayIntervention)})).catch((function(e){s(b.Error),console.log("edit failed: ",e)}))},handleDropdownChange:(e,t)=>{const n=e.target.value;d((e=>Object.assign(Object.assign({},e),{[t]:n})))},inputs:u,valueLists:o,handleBackClick:()=>a(h.DisplayIntervention),saveStatus:c}),n&&e.React.createElement(e.DataSourceComponent,{useDataSource:n[0],query:{},widgetId:t,queryCount:!0,onDataSourceCreated:e=>{i(e)}}))},Q=function(){const{widgetId:t,privilegesDelete:n,setActiveSection:a,dossierAttributes:r,useMapWidgetIds:o,dsLot:l,lot:i,dsLotIntVue:c}=(0,R.useContext)(re),[s,u]=(0,R.useState)(),[d,m]=(0,R.useState)(b.Inactive),[v,p]=(0,R.useState)(null);(0,R.useEffect)((()=>{k.default.load()}),[k.default]);const g={where:`objectid = ${i}`,outFields:["*"],returnGeometry:!0,pageSize:10},E=()=>{var e,t;const n=v.layer,r=null===(t=null===(e=n.capabilities)||void 0===e?void 0:e.operations)||void 0===t?void 0:t.supportsDelete;if(!r)return m(b.Error),void console.log("layerSupportsDelete",r);n.applyEdits({deleteFeatures:[{objectId:i}]}).then((function(e){m(b.Inactive),a(h.DisplayIntervention)})).catch((function(e){m(b.Error),console.log("delete failed: ",e)}))},y=(0,R.useCallback)((e=>{e&&u(e)}),[]),S=e.React.createElement(I.Button,{className:"mx-1",onClick:()=>a(h.DisplayIntervention),size:"default",type:"default"},"Retour"),_=(0,R.useCallback)((e=>{p(e)}),[]);return e.React.createElement(e.React.Fragment,null,e.React.createElement(e.DataSourceComponent,{useDataSource:l[0],query:g,widgetId:t,queryCount:!0,onDataSourceCreated:_},((t,a)=>{var o,l;let i;if(t.getStatus()===e.DataSourceStatus.LoadError){const t=e.React.createElement(I.Alert,{open:!0,text:"Erreur de connexion",type:"error",withIcon:!0});i=e.React.createElement(L,{title:"Lot",body:t,lowerButtons:S})}else if(t.getStatus()===e.DataSourceStatus.Loaded&&0===t.count){const t=e.React.createElement(I.Alert,{open:!0,text:"Introuvable",type:"warning",withIcon:!0});i=e.React.createElement(L,{title:"Lot",body:t,lowerButtons:S})}else if(t.getStatus()===e.DataSourceStatus.Loading){const t=e.React.createElement($,null);i=e.React.createElement(L,{title:"Lot",body:t,lowerButtons:S})}else if(t.getStatus()===e.DataSourceStatus.Loaded&&t.count>0){const a=t.getRecords(),u=a[0].getData(),m=a[0].getGeometry(),v=u.no_lot&&u.no_lot.length>0?u.no_lot:`oid-${u.objectid}`,p=`Lot ${v}`,g=e.React.createElement("div",null,(null==r?void 0:r.id_dossier)&&e.React.createElement(x,{searchKey:r.id_dossier,searchField:"id_dossier"}),e.React.createElement(O,{searchKey:u.id_dg_demande,searchField:"id_dg_demande",label:""})),R=e.React.createElement(e.React.Fragment,null,e.React.createElement("div",null,e.React.createElement(I.Label,null,"Intervention : ",u.id_dg_demande)),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Coordonnées : ",null===(o=null==m?void 0:m.x)||void 0===o?void 0:o.toFixed(3)," ",null===(l=null==m?void 0:m.y)||void 0===l?void 0:l.toFixed(3))),e.React.createElement("div",null,e.React.createElement(I.Label,null,"Création : ",f(u.date_creation)," par ",u.usager_creation," ")));let y="Supprimer";d==b.Error?y="Erreur":d==b.Inactive?y="Supprimer":d==b.Active&&(y="Suppression...");const h=e.React.createElement(e.React.Fragment,null,S,e.React.createElement(I.Button,{className:"mx-2",onClick:()=>(e=>{if(!s)return void console.error("JimuMapView not ready");let t=new j.default({wkid:4326});const n=k.default.project(e,t);s.view.goTo({center:[n.longitude,n.latitude],zoom:19})})(m),size:"default",type:"primary"},"Localiser"),n&&e.React.createElement(M,{onDelete:E,btnLabel:y,disabled:d==b.Active,elementName:`le lot ${v}`,deleteStatus:d}));i=e.React.createElement(e.React.Fragment,null,e.React.createElement(L,{title:p,navbar:g,body:R,buttons:h}),e.React.createElement(A,{queryString:`no_lot = '${u.no_lot}'`,dataSource:c[0]}))}return i})),e.React.createElement(T.JimuMapViewComponent,{useMapWidgetId:null==o?void 0:o[0],onActiveViewChange:y}))};var Y=u(8294);const X=function({handleInputChange:t,handleSaveClick:n,inputs:a,handleBackClick:r,title:o,saveStatus:l,navbar:i}){const c=e.React.createElement(e.React.Fragment,null,e.React.createElement("div",{style:{width:200}},e.React.createElement(I.Label,null," Numéro de lot",e.React.createElement(I.TextInput,{type:"text",name:"no_lot",disabled:!0,onChange:t,value:a.no_lot||""}))),!a.lat&&e.React.createElement(I.Alert,{buttonType:"default",form:"basic",open:!0,size:"medium",text:"Cliquer sur la carte pour saisir les coordonnées et le numéro du lot.",type:"info"})),s=null!=a.no_lot&&null!=a.lat&&null!=a.lon;let u="Sauvegarder",d=!1,m=!1;l===b.Inactive?(u="Sauvegarder",d=!s):l===b.Active?(u=e.React.createElement(V,{label:"Sauvegarde..."}),d=!0,m=!0):l===b.Error&&(u="Erreur...",d=!0);const v=e.React.createElement(e.React.Fragment,null,e.React.createElement(I.Button,{onClick:r,size:"default",type:"default",disabled:m},"Retour"),e.React.createElement(I.Button,{className:"mx-2",onClick:n,size:"default",type:"primary",disabled:d},u));return e.React.createElement(L,{title:o,navbar:i,body:c,buttons:v})};const ee=function(){const{widgetId:t,useMapWidgetIds:n,dsLot:a,dsCadastre:r,interventionAttributes:o,setLot:l,setActiveSection:i,dossierAttributes:c}=(0,R.useContext)(re),[s,u]=(0,R.useState)(null),[d,m]=(0,R.useState)(),[v,p]=(0,R.useState)(),[g,E]=(0,R.useState)(null),[f,y]=(0,R.useState)(b.Inactive),[_,C]=(0,R.useState)({no_lot:null,lat:null,lon:null}),D=(0,R.useRef)(null);(0,R.useEffect)((()=>{if(d&&!v&&g){console.log("adding map click action...");const e=d.view.on("click",I);p(e)}return()=>{var e,t;v&&v.remove(),(null===(t=null===(e=D.current)||void 0===e?void 0:e.items)||void 0===t?void 0:t.length)>0&&d.view.graphics.remove(D.current.items[0])}}),[d,v,g]);const I=e=>{return t=this,n=void 0,r=function*(){if(!d)return void console.error("JimuMapView not ready");const t=e.mapPoint;(({latitude:e,longitude:t})=>{C((n=>Object.assign(Object.assign({},n),{lat:e,lon:t})))})(t),(e=>{var t,n;const a=new Y.default({longitude:e.longitude,latitude:e.latitude}),r=new z.default({symbol:{type:"simple-marker",color:[0,255,255],outline:{color:[255,255,255],width:2}},geometry:a,attributes:{}});(null===(n=null===(t=D.current)||void 0===t?void 0:t.items)||void 0===n?void 0:n.length)>0&&d.view.graphics.remove(D.current.items[0]),D.current=d.view.graphics.add(r)})(t);const n=g.layer.createQuery();n.geometry=t,n.spatialRelationship="intersects",n.outFields=["*"],n.returnGeometry=!0;const a=yield g.layer.queryFeatures(n);if(a.features.length>0){a.features.length>1&&console.log("Multiple features found (cadastreDataSource)");const e=a.features[0];C((t=>Object.assign(Object.assign({},t),{no_lot:e.attributes.no_lot})))}else console.log("No features found (cadastreDataSource)"),C((e=>Object.assign(Object.assign({},e),{no_lot:null})))},new((a=void 0)||(a=Promise))((function(e,o){function l(e){try{c(r.next(e))}catch(e){o(e)}}function i(e){try{c(r.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(l,i)}c((r=r.apply(t,n||[])).next())}));var t,n,a,r},L=e.React.createElement("div",null,(null==c?void 0:c.id_dossier)&&e.React.createElement(x,{searchKey:c.id_dossier,searchField:"id_dossier"}),e.React.createElement(O,{searchKey:o.id_dg_demande,searchField:"id_dg_demande",label:""}));return e.React.createElement(e.React.Fragment,null,e.React.createElement(T.JimuMapViewComponent,{useMapWidgetId:null==n?void 0:n[0],onActiveViewChange:e=>{e&&m(e)}}),e.React.createElement(X,{title:"Ajouter lot",navbar:L,handleInputChange:e=>{const t=e.target.name,n=e.target.value;C((e=>Object.assign(Object.assign({},e),{[t]:n})))},handleSaveClick:()=>{var e,t;y(b.Active);const n=new Y.default({longitude:_.lon,latitude:_.lat}),a=new z.default({geometry:n,attributes:{id_dg_demande:o.id_dg_demande,no_lot:_.no_lot}}),r=s.layer,c=null===(t=null===(e=r.capabilities)||void 0===e?void 0:e.operations)||void 0===t?void 0:t.supportsAdd;if(!c)return y(b.Error),void console.log("layer layerSsupportsAdd",c);r.applyEdits({addFeatures:[a]}).then((function(e){y(b.Inactive);const t=e.addFeatureResults[0].objectId;l(t),i(h.DisplayLot)})).catch((function(e){y(b.Error),console.log("add failed: ",e)}))},inputs:_,handleBackClick:()=>i(h.DisplayIntervention),saveStatus:f}),a&&e.React.createElement(e.DataSourceComponent,{useDataSource:a[0],query:S,widgetId:t,queryCount:!0,onDataSourceCreated:e=>{u(e)}}),r&&e.React.createElement(e.DataSourceComponent,{useDataSource:r[0],query:{},widgetId:t,queryCount:!0,onDataSourceCreated:e=>{E(e)}}))},te=(0,R.memo)((function({widgetId:t,domainName:n,domainDataSource:a,setValueLists:r,codeField:o="code",valueField:l="description",filterField:i=null,filterFieldValue:c=null}){return e.React.createElement(e.DataSourceComponent,{useDataSource:a[0],query:{where:"1=1",outFields:["*"],pageSize:10},widgetId:t,queryCount:!0},((t,a)=>{const s=t.getStatus();if(s===e.DataSourceStatus.LoadError)return e.React.createElement("div",null,`Erreur chargement ${n}`);if(s===e.DataSourceStatus.Loading)return e.React.createElement("div",null,`Chargement ${n}...`);if(s===e.DataSourceStatus.Loaded&&0==t.count)return e.React.createElement("div",null,`Erreur: aucun enregistrement pour ${n}`);if(s===e.DataSourceStatus.Loaded&&t.count>0){const a=t.getRecords().map((e=>{const t=e.getData();return i?{code:t[o],value:t[l],filterOn:t[i]}:{code:t[o],value:t[l]}}));a.sort(((e,t)=>e.value>t.value?1:-1));let s=[...a];i&&c&&(s=a.filter((e=>e.filterOn===c)));const u=`${n}: ${t.count} valeurs dans ${t.getDataSourceJson().sourceLabel}`;return r((e=>Object.assign(Object.assign({},e),{[n]:s}))),e.React.createElement("div",null,u)}return e.React.createElement(e.React.Fragment,null,`État non supporté pour ${n} ${s}`)}))})),ne=function(){var t,n,a,r;const{widgetId:o,setActiveSection:l,widgetTitle:i,valueLists:c,setValueLists:s,dsDossierType:u,dsInterventionType:d,dsInterventionEtat:m,dsIntervenants:v}=(0,R.useContext)(re),p=e.React.createElement("div",{className:"mb-3"},"Chargement des listes de valeurs..."),g=(null===(t=null==c?void 0:c.interventionEtat)||void 0===t?void 0:t.length)>0&&(null===(n=null==c?void 0:c.interventionType)||void 0===n?void 0:n.length)>0&&(null===(a=null==c?void 0:c.intervenants)||void 0===a?void 0:a.length)>0&&(null===(r=null==c?void 0:c.interventionEtat)||void 0===r?void 0:r.length)>0;return e.React.createElement(e.React.Fragment,null,e.React.createElement(I.Button,{onClick:()=>l(h.Search),size:"default",type:"primary",disabled:!g},"Continuer")),e.React.createElement(e.React.Fragment,null,e.React.createElement("div",{className:"m-2"},e.React.createElement("h3",null,i),e.React.createElement("hr",null),p,e.React.createElement(te,{domainName:"dossierType",widgetId:o,setValueLists:s,domainDataSource:u,codeField:"code_type",valueField:"description"}),e.React.createElement(te,{domainName:"interventionType",widgetId:o,setValueLists:s,domainDataSource:d,codeField:"code_demande",valueField:"description"}),e.React.createElement(te,{domainName:"interventionEtat",widgetId:o,setValueLists:s,domainDataSource:m,codeField:"code_etat",valueField:"description"}),e.React.createElement(te,{domainName:"intervenants",widgetId:o,setValueLists:s,domainDataSource:v,codeField:"nom_prenom_ido",valueField:"nom_prenom_ido",filterField:"statut",filterFieldValue:"A"})),!g&&e.React.createElement(I.Loading,null))},ae=(0,R.memo)((({activeSection:t})=>e.React.createElement("div",{className:"widget-runtime jimu-widget p-2",style:{overflow:"auto"}},t==h.SplashScreen&&e.React.createElement(ne,null),t==h.Search&&e.React.createElement(B,null),t==h.DisplayDossier&&e.React.createElement(q,null),t==h.CreateDossier&&e.React.createElement(P,null),t==h.EditDossier&&e.React.createElement(K,null),t==h.DisplayIntervention&&e.React.createElement(W,null),t==h.CreateIntervention&&e.React.createElement(H,null),t==h.EditIntervention&&e.React.createElement(Z,null),t==h.DisplayLot&&e.React.createElement(Q,null),t==h.CreateLot&&e.React.createElement(ee,null)))),re=(0,R.createContext)(null),oe=t=>{var n,a,r,o;const[l,i]=(0,R.useState)(h.SplashScreen),[c,s]=(0,R.useState)(),[u,d]=(0,R.useState)(),[m,v]=(0,R.useState)(),[p,g]=(0,R.useState)(!0),[E,f]=(0,R.useState)(),[y,S]=(0,R.useState)(),[b,C]=(0,R.useState)(),[D,I]=(0,R.useState)(),[L,x]=(0,R.useState)(),[F,A]=(0,R.useState)({dossierType:[],interventionType:[],interventionEtat:[],intervenants:[]}),k="Gestion des dossiers EG";if(!(()=>{var e,n,a,r,o,l,i,c,s,u;return 1==(null===(e=t.config.dsDossier)||void 0===e?void 0:e.length)&&1==(null===(n=t.config.dsIntervention)||void 0===n?void 0:n.length)&&1==(null===(a=t.config.dsLot)||void 0===a?void 0:a.length)&&1==(null===(r=t.config.dsLotIntVue)||void 0===r?void 0:r.length)&&1==(null===(o=t.config.dsCadastre)||void 0===o?void 0:o.length)&&1==(null===(l=t.config.dsDossierType)||void 0===l?void 0:l.length)&&1==(null===(i=t.config.dsInterventionType)||void 0===i?void 0:i.length)&&1==(null===(c=t.config.dsInterventionEtat)||void 0===c?void 0:c.length)&&1==(null===(s=t.config.dsIntervenants)||void 0===s?void 0:s.length)&&1===(null===(u=t.useMapWidgetIds)||void 0===u?void 0:u.length)})())return e.React.createElement(w,{widgetTitle:k});const j={widgetId:t.id,widgetTitle:k,[_.Edit]:t.config[_.Edit],[_.Add]:t.config[_.Add],[_.Delete]:t.config[_.Delete],user:t.user,activeSection:l,setActiveSection:i,useMapWidgetIds:t.useMapWidgetIds,searchResultsLimit:5,dsDossier:t.config.dsDossier,dossier:c,setDossier:s,dossierAttributes:u,setDossierAttributes:d,dsDossierType:t.config.dsDossierType,dossiersCount:m,setDossiersCount:v,limitDossiersSearchResults:p,setLimitDossiersSearchResults:g,dsIntervention:t.config.dsIntervention,intervention:E,setIntervention:f,interventionAttributes:y,setInterventionAttributes:S,dsInterventionType:t.config.dsInterventionType,dsInterventionEtat:t.config.dsInterventionEtat,dsIntervenants:t.config.dsIntervenants,interventionsCount:b,setInterventionsCount:C,dsLot:t.config.dsLot,dsLotIntVue:t.config.dsLotIntVue,lot:D,setLot:I,lotsCount:L,setLotsCount:x,dsCadastre:t.config.dsCadastre,valueLists:F,setValueLists:A};return(null===(n=null==F?void 0:F.interventionEtat)||void 0===n?void 0:n.length)>0&&(null===(a=null==F?void 0:F.interventionType)||void 0===a?void 0:a.length)>0&&(null===(r=null==F?void 0:F.intervenants)||void 0===r?void 0:r.length)>0&&(null===(o=null==F?void 0:F.interventionEtat)||void 0===o?void 0:o.length)>0&&l==h.SplashScreen&&i(h.Search),e.React.createElement(re.Provider,{value:j},e.React.createElement(ae,{activeSection:l}))};function le(e){u.p=e}})(),d})())}}}));