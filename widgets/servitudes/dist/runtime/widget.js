System.register(["jimu-core","jimu-core/react","jimu-ui","jimu-arcgis","esri/geometry/geometryEngine","esri/Graphic"],(function(e,t){var n={},r={},o={},a={},c={},i={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.React=e.React},function(e){r.createContext=e.createContext,r.default=e.default,r.useContext=e.useContext,r.useEffect=e.useEffect,r.useState=e.useState},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Label=e.Label,o.Loading=e.Loading,o.NumericInput=e.NumericInput,o.Option=e.Option,o.Select=e.Select},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){c.buffer=e.buffer,c.offset=e.offset,c.union=e.union},function(e){i.default=e.default}],execute:function(){e((()=>{var e={9486:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(8081),o=n.n(r),a=n(3645),c=n.n(a)()(o());c.push([e.id,".widget-runtime-error{background-color:#d5d8dc;border:1px solid gray}",""]);const i=c},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var c={};if(r)for(var i=0;i<this.length;i++){var u=this[i][0];null!=u&&(c[u]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&c[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),o&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=o):l[4]="".concat(o)),t.push(l))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},c=[],i=0;i<e.length;i++){var u=e[i],s=r.base?u[0]+r.base:u[0],l=a[s]||0,d="".concat(s," ").concat(l);a[s]=l+1;var f=n(d),p={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var m=o(p,r);r.byIndex=i,t.splice(i,0,{identifier:d,updater:m,references:1})}c.push(d)}return c}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var c=0;c<a.length;c++){var i=n(a[c]);t[i].references--}for(var u=r(e,o),s=0;s<a.length;s++){var l=n(a[s]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}a=u}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4129:e=>{"use strict";e.exports=i},4942:e=>{"use strict";e.exports=c},6826:e=>{"use strict";e.exports=a},8891:e=>{"use strict";e.exports=n},1315:e=>{"use strict";e.exports=r},726:e=>{"use strict";e.exports=o}},t={};function u(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,u),o.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="",u.nc=void 0;var s={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(s),u.d(s,{WidgetContext:()=>j,__set_webpack_public_path__:()=>O,default:()=>A});var e=u(3379),t=u.n(e),n=u(7795),r=u.n(n),o=u(569),a=u.n(o),c=u(3565),i=u.n(c),l=u(9216),d=u.n(l),f=u(4589),p=u.n(f),m=u(9486),v={};v.styleTagTransform=p(),v.setAttributes=i(),v.insert=a().bind(null,"head"),v.domAPI=r(),v.insertStyleElement=d(),t()(m.Z,v),m.Z&&m.Z.locals&&m.Z.locals;var g=u(8891),y=u(1315),h=u(726);const E=function({children:e}){return g.React.createElement("div",null,g.React.createElement(h.Alert,{buttonType:"default",form:"basic",open:!0,size:"medium",text:e,type:"warning",withIcon:!0}))};var b=u(6826),R=u(4942),S=u(4129);const C=function({label:e=" Save"}){return g.React.createElement("div",{style:{position:"relative"}},e,g.React.createElement(h.Loading,{height:null,width:null,type:"BAR"}))},x=function({jmv:e}){const{selectedLayerId:t,setSelectedLayerId:n}=(0,y.useContext)(j),[r,o]=(0,y.useState)([]);return(0,y.useEffect)((()=>{if(!e)return;const r=null==e?void 0:e.jimuLayerViews;if(!r)return;const a=[];for(const e in r){const t=r[e];(null==t?void 0:t.layer)&&a.push(t.layer)}let c;o(a),a.forEach((e=>{"cadastre"===e.title&&(c=e.id)})),c&&!t&&n(c)}),[e]),y.default.createElement(y.default.Fragment,null,y.default.createElement(h.Label,null,"Source",y.default.createElement(h.Select,{onChange:e=>{var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)&&n(e.target.value)},onClick:()=>{},placeholder:"Sélectionner",size:"default",value:t},r.map((e=>y.default.createElement(h.Option,{value:e.id},e.title))))))},w=function(){const{widgetId:e,opType:t,setOpType:n}=(0,y.useContext)(j);return g.React.createElement(g.React.Fragment,null,g.React.createElement(h.Label,null,"Opération géométrique",g.React.createElement(h.Select,{defaultValue:"offset",onChange:e=>{n(e.target.value)},onClick:()=>{},placeholder:"Type d'opération",size:"default",value:t},g.React.createElement(h.Option,{value:"offset"},"Offset"),g.React.createElement(h.Option,{value:"buffer"},"Buffer"),g.React.createElement(h.Option,{value:"copy"},"Copie"))))},I=function(){const{widgetId:e,distance:t,setDistance:n}=(0,y.useContext)(j);return g.React.createElement(g.React.Fragment,null,g.React.createElement(h.Label,null,"Distance",g.React.createElement(h.NumericInput,{autoFocus:!0,placeholder:"Distance",value:t,precision:3,title:"Distance",showHandlers:!1,onChange:e=>{e<0||n(e)}})))};var T;!function(e){e.Inactive="Inactive",e.Active="Active",e.Error="Error"}(T||(T={}));const L=function(){const{widgetId:e,useMapWidgetIds:t,dsServitudes:n,distance:r,opType:o,selectedLayerId:a}=(0,y.useContext)(j),[c,i]=(0,y.useState)(),[u,s]=(0,y.useState)(null),[l,d]=(0,y.useState)(T.Inactive),[f,p]=(0,y.useState)(""),m=e=>{var t,n;const r=new S.default({geometry:e,attributes:{no_coordination:"Test",code_operation:"S1"}}),o=u.layer;(null===(n=null===(t=o.capabilities)||void 0===t?void 0:t.operations)||void 0===n?void 0:n.supportsAdd)?o.applyEdits({addFeatures:[r]}).then((function(e){const t=e.addFeatureResults[0].objectId;console.log("newId",t),d(T.Inactive),p(`Servitude créée : ${t}`)})).catch((function(e){console.error("add failed: ",e),v()})):v("La couche ne supporte pas d'éditions")},v=e=>{p(e),l!=T.Error&&(setTimeout((()=>{d(T.Inactive),p(null)}),6e3),d(T.Error))};let E="Créer servitude",L=!1;return l===T.Inactive?(E="Créer servitude",L=!1):l===T.Active?(E=g.React.createElement(C,{label:"Création..."}),L=!0):l===T.Error&&(E="Erreur...",L=!0),g.React.createElement(g.React.Fragment,null,g.React.createElement(b.JimuMapViewComponent,{useMapWidgetId:t[0],onActiveViewChange:e=>{e&&i(e)}}),n&&g.React.createElement(g.DataSourceComponent,{useDataSource:n[0],query:{},widgetId:e,queryCount:!0,onDataSourceCreated:e=>{s(e)}}),g.React.createElement("div",{className:"mt-2"},g.React.createElement(x,{jmv:c})),g.React.createElement("div",{className:"mt-2"},g.React.createElement(w,null)),["offset","buffer"].includes(o)&&g.React.createElement("div",{className:"mt-2"},g.React.createElement(I,null)),g.React.createElement("div",{className:"mt-2"},g.React.createElement(h.Button,{type:"primary",onClick:()=>{return e=this,t=void 0,i=function*(){d(T.Active),p("En cours...");const e=(()=>{var e;const t=null==c?void 0:c.jimuLayerViews;if(t)for(const n in t){const r=t[n];if((null===(e=null==r?void 0:r.layer)||void 0===e?void 0:e.id)===a)return r}})(),t=yield e.getSelectedFeatures();let n;if((null==t?void 0:t.length)<1)v("Aucune entité sélectionnée");else if((null==t?void 0:t.length)>20)v("Veuillez réduire le mombre d'entités sélectionnées");else{if(1===(null==t?void 0:t.length))n=t[0].geometry;else{if(!((null==t?void 0:t.length)>1))return void v("Erreur");{console.log("Regroupement...");const e=t.map((e=>e.geometry));console.log("geoms",e),n=(0,R.union)(e),console.log("union geom",n)}}if(["offset","copy"].includes(o)&&"polygon"!==n.type)v("Sélectionner des polygones");else if(!["offset","buffer"].includes(o)||r>0)if("offset"==o){console.log("Distance offset",r);const e=(0,R.offset)(n,r,"meters");console.log("offsetGeom",e),m(e)}else if("buffer"==o){console.log("Distance buffer",r);const e=(0,R.buffer)(n,r,"meters");console.log("bufferGeom",e),m(e)}else"copy"==o?m(n):v("Type opération non supporté");else v("Choisir une distance positive")}},new((n=void 0)||(n=Promise))((function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function c(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((i=i.apply(e,t||[])).next())}));var e,t,n,i},style:{marginTop:10},disabled:!c||L},E)),g.React.createElement("div",{className:"mt-2"},f))},M=()=>{const{widgetTitle:e,user:t,useMapWidgetIds:n,dsCadastre:r,dsServitudes:o}=(0,y.useContext)(j),a=n&&1===(null==n?void 0:n.length),c=1===(null==o?void 0:o.length);let i=g.React.createElement("div",null,"Chargement...");return i=a?c?g.React.createElement(g.React.Fragment,null,g.React.createElement(L,null)):g.React.createElement(E,null,"Choisir les couches dans le panneau de configuration"):g.React.createElement(E,null,"Choisir la carte dans le panneau de configuration"),g.React.createElement("div",{className:"widget-runtime jimu-widget p-2",style:{overflow:"auto"}},g.React.createElement("h2",null,e),g.React.createElement("hr",null),i)},j=(0,y.createContext)(null),A=e=>{const[t,n]=(0,y.useState)(0),[r,o]=(0,y.useState)("offset"),[a,c]=(0,y.useState)(),i={widgetId:e.id,user:e.user,widgetTitle:"Servitudes",useMapWidgetIds:e.useMapWidgetIds,dsServitudes:e.config.dsServitudes,distance:t,setDistance:n,opType:r,setOpType:o,selectedLayerId:a,setSelectedLayerId:c};return g.React.createElement(j.Provider,{value:i},g.React.createElement(M,null))};function O(e){u.p=e}})(),s})())}}}));